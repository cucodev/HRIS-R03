
@{
    ViewBag.Title = "Leave";
    Layout = "~/Views/Shared/_LayoutLeftNav.cshtml";
}
<script src=@Url.Content("~/Scripts/hrisframework/hris.js")></script>
<script src=@Url.Content("~/Scripts/jquery.ui.min.js")></script>
<script src=@Url.Content("~/Scripts/multidatepicker/jquery-ui.multidatespicker.js")></script>
<link rel="stylesheet" type="text/css" href=@Url.Content("~/Content/multidatepicker/mdp.css")>

<div class="row">
    <div class="btn-group btn-breadcrumb">
        <a href="#" class="btn btn-primary"><i class="glyphicon glyphicon-home"></i></a>
        <a href="#" class="btn btn-info">Forms</a>
        <a href="#" class="btn btn-success">Leave</a>
    </div>
    <!--<h2 style="border-bottom: 1px solid #052135">Matrix - HRD</h2style="border-bottom:>-->
    <h1 style="margin-bottom:0; margin-top:0; text-align:left; letter-spacing:-1px; line-height:1; font-family: Arial, Helvetica, sans-serif; font-size: 25px; font-weight: bold; padding-bottom:0; padding-top:15px;">LEAVE FORM</h1>
    <h2 style="margin-bottom:15px; margin-top:0;   border-bottom: solid 1px #d7e9f3; padding-left:30px; font-size:14px; font-family:Calibri">Apply Leave and See Your Form Status</h2>
</div>
<br />

<script type="text/javascript">
    $(document).ready(function () {

        var Balance = 5;

        var dateInArray = [];
        var totalDays = 0;
        var data = new Array();
        var row = {};
        var subrow = {};
        var durations = new Array();
        durations.records = [{ label: 'FullDay', value: 1 }, { label: 'Half Day', value: 0 }];

        var source = {
            localdata: data,
            dataType: "array",
            dataFields:
            [
                { name: 'id', type: 'number' },
                { name: 'date', type: 'date' },
                { name: 'duration', type: 'int' },
                { name: 'durationLabel', type: 'bool' },
                //{ name: 'durationLabel', value: 'duration', values: { source: durations.records, value: 'value', name: 'label' } }
            ],
            updaterow: function (rowid, rowdata, commit) {
                // that function is called after each edit.
                
                if (rowdata.durationLabel) {
                    //totalDays = totalDays - 0.5;
                    data[rowdata.id]["duration"] = 1;
                } else {
                    data[rowdata.id]["duration"] = 0.5;
                }
                //console.log("durationLabel: ", rowdata.durationLabel);
                totalDays = 0;
                for (i = 0; i < data.length; i++) {
                    b = data[i]["duration"];
                    totalDays = totalDays + b;
                    //console.log(i + ' -- ' + b + ' - data.lengh=' + data.length + ' - totalDays:' + totalDays);
                };
                //console.log('Update: Total Days: ' + totalDays);
                $("#totalFullDays").html("<strong>" + totalDays + "</strong> Days");
                commit(true); 
            }

        };
        console.log("source: ", source.dataFields)
        var dataAdapter = new $.jqx.dataAdapter(source, { autoBind: true });
        var columns = [
                          { text: 'Index', dataField: 'id', width: 10, hidden: true },
                          { text: 'Date', dataField: 'date', cellsformat: 'D', width: '65%', editable: false },
                          {
                              text: 'Full Days', dataField: 'durationLabel', columntype: 'checkbox', width: '35%'
                              //text: 'Full Day', cellalign: 'center', datafield: 'duration', width: '35%', displayfield: 'durationLabel', columntype: 'checkbox',
                              //createeditor: function (row, value, editor) {
                                //  editor.jqxCheckBox({ source: durations.records, displayMember: 'label', valueMember: 'value' });
                             // }
                          }
        ];

        $("#table").jqxGrid({
            width: '100%',
            height: 200,
            theme: 'metro',
            //height: 300,
            editable: true,
            source: dataAdapter,
            columns: columns,
            //selectionmode: 'singlecell'
        });

        //COMPONENT
        hris.general.bindButton('Apply');
        hris.general.bindDropDown("getPolicyType", null);
        $('#isAnnual').jqxSwitchButton({ height: 35, width: '100%', checked: true, onLabel: 'COMMON', offLabel: 'ANNUAL', theme: 'orange' });
        var today = new Date();
        var y = today.getFullYear();
        $('#full-year').multiDatesPicker({
            numberOfMonths: [2, 3],
            dateFormat: "dd/mm/yy",
            onSelect: function (date, el) {
                if (checkBalance(totalDays)) {
                    i = 0;
                    data = [];
                    totalDays = 0;
                    dateTemp = date;
                    addDate(date);
                    dateInArray.forEach(dateSelected);
                    try {
                        //console.log(data);
                        source.localdata = data;
                        $("#totalFullDays").html("<strong>" + totalDays + "</strong> Days");
                        $("#table").jqxGrid('updatebounddata');
                    } catch (err) {
                        console.log("Error : ", err);
                    }
                } else {
                    //$('#full-year').disabled();
                }
            }
        });

        //FUNCTION
        function checkBalance(td) {
            //if (totalDays >= 4) $('#full-year').multiDatesPicker({ disabled: true });
            if (td <= Balance) return false;
        }

        function addDate(date) {
            if (dateInArray.find(checkDate, date)) {
                var i = dateInArray.indexOf(date, 0);
                if (i != -1) dateInArray.splice(i, 1);
            } else {
                dateInArray.push(date);
            }

        }

        function checkDate(dateInArray) {
            return dateInArray == dateTemp;
        }

        function dateSelected(item, index) {
            row = {};
            var datestr = item;
            //console.log("Index[" + index + "] : " + datestr);
            row["durationLabel"] = true;
            row["duration"] = 1;
            row["date"] = datestr;
            row["id"] = index;
            data[i] = row;
            totalDays = totalDays + 1;
            i++;
        }

        

        function clear() {
            $('#full-year').multiDatesPicker('resetDates', 'picked');
            $('#getPolicyType').jqxDropDownList({ selectedIndex: -1 });
            data = [];
            dateInArray = [];
            source.localdata = data;
            $("#table").jqxGrid('updatebounddata');
        }

        //EVENT
        $('.jqx-switchbutton').on('checked', function (event) {
            $('#isAnnual').jqxSwitchButton({ offLabel: 'ANNUAL' });
            $('#getPolicyType').hide();
            $("#totalAnnualCarry").hide();
            $("#totalAnnualCurrent").hide();
            $("#totalAnnualCarryLabel").hide();
            $("#totalAnnualCurrentLabel").hide();
            clear();
        });
        $('.jqx-switchbutton').on('unchecked', function (event) {
            $('#isAnnual').jqxSwitchButton({ onLabel: 'COMMON' });
            $("#totalAnnualCarry").show();
            $("#totalAnnualCurrent").show();
            $("#totalAnnualCarryLabel").show();
            $("#totalAnnualCurrentLabel").show();
            $('#getPolicyType').show();
            clear();
        });
        


    })
</script>
<style>
    .HR-Div {
        padding: 5px;
        margin-bottom: 3px;
        border: 1px solid transparent;
        border-radius: 4px;
    }
    .HR-Warning {
        color: #c09853;
        background-color: #fcf8e3;
        border-color: #fbeed5;
    }

    .HR-Info {
        color: #3a87ad;
        background-color: #d9edf7;
        border-color: #bce8f1;
    }

</style>
<div class="row">
    <div class="col-md-2 pull-left">
        <input type="button" value="COMMON" id='isAnnual' style="margin-left:5px" />
    </div>

    <div class="col-md-5">
        <div id="getPolicyType" style="padding-right: -40px; width: 0;"></div>
    </div>
    <div class="col-md-5 ">
        <input type="button" value="APPLY" id='Apply' />
    </div>
</div>
<div class="row">
    <div class="col-md-7">
        <div id="demo">
            <ul style="margin-left: 0; padding-left: 0;">
                <li class="demo full-row">
                    <div id="full-year"></div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col-md-5">

        <div class="row">
            <div class="col-md-10">
                <div id="table" style="margin-top:15px"></div>
            </div>
        </div>
        <br />
        <div class="row" style="margin-top:5px">
            <div class="col-md-3">
                <div class="HR-Div alert-success">Balance</div>
            </div>
            <div class="col-md-7 ">
                <div class="HR-Div " id="totalBalance">Days</div>
            </div>
        </div>
        <div class="row" style="margin-top:5px">
            <div class="col-md-3">
                <div class="HR-Div HR-Info">Applied Days</div>
            </div>
            <div class="col-md-7 ">
                <div class="HR-Div " id="totalFullDays">Days</div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-10">
                <hr class="Line" />
            </div>
        </div>
        

        
        <div class="row" style="margin-top:0">
            <div class="col-md-3">
                <div class="HR-Div alert-info" id="totalAnnualCarryLabel">Carry Over</div>
            </div>
            <div class="col-md-7">
                <div class="HR-Div" id="totalAnnualCarry"> Days</div>
            </div>
        </div>
        <div class="row" style="margin-top:0">
            <div class="col-md-3">
                <div class="HR-Div alert-info" id="totalAnnualCurrentLabel">Annual </div>
            </div>
            <div class="col-md-7">
                <div class="HR-Div" id="totalAnnualCurrent"> Days</div>
            </div>
        </div>

    </div>


</div>




<div class="row">
    <div class="col-md-10">
        <!--FOOTER-->
        <label style="font-size:12px; font-family:Calibri; color:indianred; margin-right:30px">
            Credential Info: @ViewBag.cUser : @ViewBag.cIDV : Parent= @ViewBag.cIDVParent , ParentLevel= @ViewBag.cIDVParentLevel , Name= @ViewBag.cName
        </label>
    </div>
</div>
